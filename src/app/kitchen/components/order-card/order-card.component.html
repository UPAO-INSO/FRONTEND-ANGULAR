<div
  class="bg-side-background rounded-xl font-poppins-medium shadow-md p-4 w-full min-w-[280px] h-[calc(50vh-40px)] flex flex-col gap-3 hover:shadow-lg transition-shadow"
>
  <div class="flex flex-row justify-between flex-shrink-0">
    <div class="items-start">
      <span class="font-fira-bold text-2xl">Mesa {{ order().tableId }}</span>
    </div>

    <div class="flex flex-row items-end gap-3 mb-1">
      <span
        class="badge pt-1 text-gray-200 font-semibold {{ statusColor() }}"
        >{{ statusLabel() }}</span
      >
      <span class="text-xs pb-0.5 text-gray-500 text-right">
        {{ order().createdAt | date : "HH:mm" }}
      </span>
    </div>
  </div>

  <div class="flex-1 overflow-hidden flex flex-col">
    <div class="text-xs text-gray-400 mb-2 flex-shrink-0">
      {{ order().totalItems }} productos:
    </div>

    <!-- ✅ Lista con altura calculada dinámicamente -->
    <ul
      class="text-sm text-gray-300 font-poppins-semibold space-y-2 flex-1 overflow-y-auto custom-scrollbar pr-2 pb-2"
    >
      @for (prod of order().productOrders; track prod.id) {
      <li class="flex justify-between text-sm">
        <span class="truncate mr-2">
          {{ prod.quantity }}x - {{ prod.productName | titlecase }}
        </span>
      </li>
      }
    </ul>
  </div>

  <div class="flex-shrink-0 space-y-2 pt-2 border-t border-gray-600/30">
    <div class="text-sm text-yellow-500 italic">
      Comentario: {{ order().comment }}
    </div>

    @if (order().orderEmployees.length > 0) {
    <div class="pb-2 flex flex-row gap-3">
      <span class="fa-solid fa-user text-xs text-gray-400"></span>
      <div class="text-xs text-gray-400">
        <span class="truncate text-xs">
          {{ order().orderEmployees[0].employeeName | titlecase }}
          {{ order().orderEmployees[0].employeeLastname | titlecase }}
        </span>
      </div>
    </div>
    }

    <div class="flex items-center gap-2 pb-2">
      @if (order().orderStatus === orderStatus.PENDING) {
      <button
        class="btn bg-status-to-preparation flex-1 btn-sm text-white font-poppins-semibold text-[17px] p-6"
        (click)="onStatusChange(orderStatus.PREPARING)"
      >
        <span class="fa-solid fa-play mr-1 text-sm"></span>
        Iniciar Preparación
      </button>
      } @else if (order().orderStatus === orderStatus.PREPARING) {
      <button
        class="btn bg-status-to-ready flex-1 btn-sm text-white font-poppins-semibold text-[17px] p-6"
        (click)="onStatusChange(orderStatus.READY)"
      >
        <span class="fa-solid fa-check mr-1 text-sm"></span>
        Marcar como Listo
      </button>
      } @else if (order().orderStatus === orderStatus.READY) {
      <button
        class="btn flex-1 btn-sm btn-disabled font-semibold text-lg p-6"
        disabled
      >
        <span class="fa-solid fa-clock mr-1 text-sm"></span>
        Esperando Entrega
      </button>
      }

      <div class="dropdown dropdown-end">
        <div
          tabindex="0"
          role="button"
          class="btn btn-ghost btn-xs text-gray-400 hover:text-white"
        >
          <span class="fa-solid fa-ellipsis-vertical text-sm"></span>
        </div>

        <ul
          tabindex="0"
          class="dropdown-content menu bg-side-background rounded-box z-[1] w-52 p-2 shadow-xl border border-gray-600"
        >
          <li class="menu-title text-xs text-gray-400 px-2 pb-1">
            <span>Cambiar estado</span>
          </li>

          @for (status of allStatuses; track status.value) {
          <li>
            <a
              class="text-sm justify-start"
              [class.active]="status.value === order().orderStatus"
              (click)="onStatusChange(status.value)"
            >
              <span class="badge {{ status.color }} badge-sm"></span>
              {{ status.label }}
              @if (status.value === order().orderStatus) {
              <span class="fa-solid fa-check text-success ml-auto"></span>
              }
            </a>
          </li>
          }
        </ul>
      </div>
    </div>
  </div>
</div>

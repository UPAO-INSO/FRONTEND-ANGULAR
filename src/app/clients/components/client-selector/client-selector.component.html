@if (isOpen()) {
<dialog class="modal modal-open">
  <div class="modal-box bg-side-background max-w-2xl">
    <h3 class="font-bold text-xl text-white mb-4">
      <span class="fa-solid fa-users mr-2"></span>
      Seleccionar Cliente
    </h3>

    <!-- Barra de búsqueda -->
    <div class="mb-4">
      <div class="form-control">
        <div class="input-group flex flex-row gap-2">
          <input
            type="text"
            placeholder="Buscar por DNI o RUC..."
            class="input input-bordered w-full bg-gray-800 text-white"
            [value]="documentQuery()"
            (input)="onSearchInput($event)"
          />
          <!--  -->
          @if (documentQuery()) {
          <button
            class="btn btn-square text-gray-300 bg-gray-900 hover:bg-gray-600 border-0"
            (click)="clearSearch()"
          >
            <span class="fa-solid fa-xmark"></span>
          </button>
          }

          <!--  -->
          <button class="btn btn-square btn-primary">
            <span class="fa-solid fa-search"></span>
          </button>
        </div>
      </div>
      <p class="text-xs text-gray-500 mt-1 ml-1">
        Ingresa al menos 3 caracteres para buscar
      </p>
    </div>

    <!-- Estado de carga -->
    @if (clientsResource.isLoading()) {
    <div class="flex justify-center items-center py-8">
      <span class="loading loading-spinner loading-lg text-primary"></span>
    </div>
    }

    <!-- Mensaje de error -->
    @if (clientsResource.error()) {
    <div class="alert alert-error">
      <span class="fa-solid fa-exclamation-triangle"></span>
      <span>Error al cargar clientes. Intenta nuevamente.</span>
    </div>
    }

    <!-- Lista de clientes -->
    @if (!clientsResource.isLoading() && !clientsResource.error()) {
    <div class="max-h-96 overflow-y-auto custom-scrollbar">
      @if (getClients().length === 0) {
      <div class="text-center py-8 text-gray-500">
        <span class="fa-solid fa-user-slash text-4xl mb-2 block"></span>
        <p>No se encontraron clientes</p>
      </div>
      } @else {
      <div class="space-y-2">
        @for (client of getClients(); track client.id) {
        <div
          class="card bg-gray-800 hover:bg-gray-700 cursor-pointer transition-all border-2 {{
            selectedClient()?.id === client.id
              ? 'border-primary'
              : 'border-transparent'
          }}"
          (click)="onSelectClient(client)"
        >
          <div class="card-body p-4">
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <h4 class="font-semibold text-white text-lg">
                  {{ getClientFullName(client) }}
                </h4>
                <div class="flex flex-wrap gap-x-4 gap-y-1 mt-2 text-sm">
                  <div class="flex items-center gap-1 text-gray-400">
                    <span class="fa-solid fa-id-card"></span>
                    <span>{{ client.documentNumber }}</span>
                  </div>
                  <div class="flex items-center gap-1 text-gray-400">
                    <span class="fa-solid fa-envelope"></span>
                    <span>{{ client.email }}</span>
                  </div>
                  <div class="flex items-center gap-1 text-gray-400">
                    <span class="fa-solid fa-phone"></span>
                    <span>{{ client.phone }}</span>
                  </div>
                </div>
              </div>
              @if (selectedClient()?.id === client.id) {
              <div class="badge badge-primary badge-lg">
                <span class="fa-solid fa-check mr-1"></span>
                Seleccionado
              </div>
              }
            </div>
          </div>
        </div>
        }
      </div>
      }
    </div>

    <!-- Paginación -->
    @if (!documentQuery()) {
    <app-pagination [pages]="getTotalPages()" [currentPage]="currentPage()" />
    } }

    <!-- Botones de acción -->
    <div class="modal-action">
      <button class="btn btn-ghost" (click)="close()">Cancelar</button>
      <button
        class="btn btn-primary"
        [disabled]="!selectedClient()"
        (click)="onConfirm()"
      >
        <span class="fa-solid fa-check mr-2"></span>
        Confirmar Cliente
      </button>
    </div>
  </div>

  <form method="dialog" class="modal-backdrop">
    <button class="" (click)="close()">close</button>
  </form>
</dialog>
}
